# aws_sam_appsync_typescript_template

This is a simple prject template for building AWS Serverless applications with AppSync using AWS SAM and typescript
This project contains source code and supporting files for a serverless application that you can deploy with the SAM CLI or NPM. 
The application uses several AWS resources, including Lambda functions and an API Gateway API. These resources are defined in the `template.yaml` file in this project. 

## What you need to run this project

This project is based on the AWS Serverless Application Model Command Line Interface (SAM CLI). That is an extension of the AWS CLI that adds functionality for building and testing Lambda applications. It uses Docker to run your functions in an Amazon Linux environment that matches Lambda. It can also emulate your application's build environment and API.

You need the following tools.

* SAM CLI - [Install the SAM CLI](https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/serverless-sam-cli-install.html)
* Node.js - [Install Node.js 10](https://nodejs.org/en/), including the NPM package management tool.

## Build and test locally

You can use the following scripts via npm in order to compile, build, test and deploy your application.

Build your application with the `npm run compile_and_build` command.

```bash
# generate code whenever the graphql schema change
$ npm run codegen
# transpile typescript files creating the built folder
$ npm run compile
# execute the unit tests
$ npm run test
# build the sam model
$ npm run build
```

Under the hood the SAM CLI installs dependencies defined in `package.json`, creates a deployment package, and saves it in the `.aws-sam/build` folder.

Currently it is not possible to start an AppSync instance locally. Therefore you need to deploy the application first and then execute integration tests.

```bash
# deploy to AWS
$ npm run deploy
# set API_KEY and ENDPOINT env variables with the values generated by the preceding command
# and run the integration test
$ API_KEY=****** ENDPOINT=******* npm run integ-test
```

You can also create a .env file containing the API_KEY and ENDPOINT variables in the project folder

```bash
# go to the root level of the project
$ cd ~/../AWS_SAM_APPSYNC_TYPESCRIPT_TEMPLATE
# create .env file with the 2 env variables
$ touch .env
$ ehco "API_KEY=****" >> .env
$ ehco "ENDPOINT=****" >> .env
# and run the integration test
$ npm run integ-test
```



Run functions locally and invoke them with the `sam local invoke` command.

```bash
$ sam local invoke putItemFunction --event events/event.json
```

## Fetch, tail, and filter Lambda function logs

To simplify troubleshooting, SAM CLI has a command called `sam logs`. `sam logs` lets you fetch logs generated by your deployed Lambda function from the command line. In addition to printing the logs on the terminal, this command has several nifty features to help you quickly find the bug.

```bash
$ sam logs -n <YourFunctionNameInTemplate.yml> --stack-name <YourCloudFormationStackName> --tail
```

You can find more information and examples about filtering Lambda function logs in the [SAM CLI Documentation](https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/serverless-sam-cli-logging.html).

## Cleanup

To delete the application that you created, use following:

```bash
$ npm run delete
```

